<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An R interface to COMPASS, the gene expression compendia GraphQL endpoint • rcompass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An R interface to COMPASS, the gene expression compendia GraphQL endpoint">
<meta property="og:description" content="rcompass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcompass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rcompass.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/usecase01.html">Use Case 01</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/onertipaday/rcompass/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rcompass_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An R interface to COMPASS, the gene expression compendia GraphQL endpoint</h1>
                        <h4 class="author">Paolo Sonego</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/onertipaday/rcompass/blob/master/vignettes/rcompass.Rmd"><code>vignettes/rcompass.Rmd</code></a></small>
      <div class="hidden name"><code>rcompass.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>How to query COMPASS from R</p>
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><code>rcompass</code> installation from github requires the devtools package to be installed.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"devtools"</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"onertipaday/rcompass"</span>)</pre></body></html></div>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a>Getting help</h2>
<p>To get help open an issue on the <code>rcompass</code> <a href="https://github.com/onertipaday/rcompass/issues">github page</a>.</p>
</div>
<div id="the-resource" class="section level2">
<h2 class="hasAnchor">
<a href="#the-resource" class="anchor"></a>The resource</h2>
<p><a href="http://compass.fmach.it/graphql/">COMPASS</a> GraphQL Endpoint <a href="https://compass-.readthedocs.io/en/latest/index.html">COMPASS documentation</a></p>
</div>
<div id="the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#the-package" class="anchor"></a>The package</h2>
<p>COMPASS (COMpendia Programmatic Access Support Software) is a software layer that provides a GraphQL endpoint to query compendia built using COMMAND&gt;_ technology <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6348648/">1</a>. COMPASS is meant to be the barebone interface on top of a compendium database from a single location with a unified output format. The <code>rcompass</code> package make this possible from within R. Do do so, it relies on the <code>httr</code> package to query the GraphQL interface, and access and retrieve data.</p>
</div>
</div>
<div id="a-brief-rcompass-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#a-brief-rcompass-overview" class="anchor"></a>A Brief rCOMPASS overview</h1>
<p>The <code>rcompass</code> package is build around a bunch of functions enable to query the compendium of interest and retrieve, store and manipulate data. Each of these functions are described in more details in their respective manual pages. We start by loading the package.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rcompass</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; This is 'rCOMPASS' version 0.0.3 based on COMPASS version 0.8.0.</span></pre></body></html></div>
</div>
<div id="case-study" class="section level1">
<h1 class="hasAnchor">
<a href="#case-study" class="anchor"></a>Case Study</h1>
<p>Here we illustrate one of the most common usages of rCOMPASS: how to create a module from a set of known genes and automatically selecting condition contrasts. To demonstrate all this we will focus on a set of genes regulated by the phytohormone abscisic acid (ABA) in pre-véraison berries in Vitis vinifera.</p>
<div id="step-1---create-the-initial-module" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1---create-the-initial-module" class="anchor"></a>Step 1 - create the initial module</h2>
<p>We start by creating a module with these 55 ABA modulated genes and refining it by selecting the most co-expressed genes. The module will be manually split to distinguish different condition contrasts, corresponding to different biological contexts, in which ABA affects gene expression. Finally, we will extend these modules to include other relevant genes by coexpression (which could hint at similar forms of regulation).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># aba_genes &lt;- c("VIT_05s0077g00430", "VIT_14s0060g00790", "VIT_14s0066g00810", "VIT_16s0050g00390", "VIT_18s0001g10450", "VIT_11s0016g03180", "VIT_08s0058g00470", "VIT_17s0000g01080", "VIT_06s0004g04860", "VIT_00s0322g00030", "VIT_06s0061g00730", "VIT_07s0005g00140", "VIT_00s0934g00010", "VIT_18s0001g04800", "VIT_01s0011g04820", "VIT_00s0216g00060", "VIT_18s0072g01220", "VIT_15s0048g02870", "VIT_00s0203g00070", "VIT_19s0014g03290", "VIT_01s0026g02710", "VIT_17s0000g08080", "VIT_00s0429g00040", "VIT_00s1206g00010", "VIT_09s0002g03690", "VIT_13s0067g00240", "VIT_07s0104g00350", "VIT_04s0023g02480", "VIT_18s0001g08490", "VIT_13s0019g02110", "VIT_04s0008g01120", "VIT_10s0003g00390", "VIT_03s0017g01410", "VIT_08s0007g08030", "VIT_08s0040g01820", "VIT_08s0058g01260", "VIT_09s0002g00630", "VIT_14s0068g01620", "VIT_18s0001g01030", "VIT_16s0050g01880", "VIT_08s0007g08280", "VIT_09s0002g06790", "VIT_09s0002g00640", "VIT_03s0063g01790", "VIT_04s0044g01230", "VIT_08s0040g02610", "VIT_01s0010g03680", "VIT_01s0137g00780", "VIT_02s0025g00500", "VIT_06s0004g05650", "VIT_07s0005g01080", "VIT_13s0156g00100", "VIT_17s0000g01120", "VIT_18s0001g07840", "VIT_18s0001g09290")</span>
<span class="co"># mod_aba_coreset &lt;- create_module_bf(compendium = "vespucci", biofeaturesNames = aba_genes)</span>
<span class="no">gene_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'VIT_00s0246g00220'</span>,<span class="st">'VIT_00s0332g00060'</span>,<span class="st">'VIT_00s0332g00110'</span>,<span class="st">'VIT_00s0332g00160'</span>,<span class="st">'VIT_00s0396g00010'</span>,<span class="st">'VIT_00s0505g00030'</span>,<span class="st">'VIT_00s0505g00060'</span>,<span class="st">'VIT_00s0873g00020'</span>,<span class="st">'VIT_00s0904g00010'</span>)
<span class="co"># mod_bf &lt;- create_module_bf(biofeaturesNames=my_bf, version = "legacy")</span></pre></body></html></div>
<p>Plot the heatmap</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"># biclustering
# library(ECLRMC)
# library(biclust)
# impdata &lt;- ECLRMC(mod_bf, beta = 0.1)
# set.seed(1)
# res &lt;- biclust(impdata, method=BCPlaid(), verbose=FALSE)</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"># num = 1
# col = colorRampPalette(c("red", "white", "darkblue"), space="Lab")(10)
#     p = par(mai=c(0,0,0,0))
#     heatmapBC(impdata, res, number=num, 
#               xlab="", ylab="",
#               order=TRUE, useRaster=TRUE, col=col)
#     par(p)
#       parallelCoordinates(impdata, res, number=num)
#       impdata[which(res@RowxNumber[, num]), which(res@NumberxCol[num, ])]</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"># suppressPackageStartupMessages(library("plotly"))
# library(tidyr)
# library(ggplot2)
# options(scipen = 0)
# df &lt;- data.frame(mod_bf)
# df &lt;- data.frame(names = row.names(df), df)
# 
# pivot_longer(cols = everything(),
#                names_to = "gene", 
#                values_to = "expression")
#   
# exp.long &lt;- pivot_longer(data = df, 
#                          cols = everything(),
#                          names_to = "gene", 
#                          values_to = "expression")
# head(exp.long)
# 
# p &lt;- ggplot(mod_bf, aes(x, y, color = Country)) +
#   geom_point(aes(frame = Date)) + theme_bw()
# 
# ggplotly(p)

# fig &lt;- plot_ly(
#             z = mod_bf,
#             colorscale = list(c(0,0.5,1),c("green", "white", "red")),
#             type = "heatmap"
#             )
# 
# fig</pre></body></html></div>
</div>
</div>
<div id="session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h1>
<pre><code>#&gt; R version 3.6.3 (2020-02-29)
#&gt; Platform: x86_64-redhat-linux-gnu (64-bit)
#&gt; Running under: Fedora 32 (Workstation Edition)
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS/LAPACK: /usr/lib64/libopenblas-r0.3.9.so
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] rcompass_0.0.3
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.4.6     rstudioapi_0.11  knitr_1.29       magrittr_1.5    
#&gt;  [5] MASS_7.3-51.5    graphql_1.5      R6_2.4.1         rlang_0.4.6     
#&gt;  [9] stringr_1.4.0    tools_3.6.3      xfun_0.15        htmltools_0.5.0 
#&gt; [13] yaml_2.2.1       assertthat_0.2.1 digest_0.6.25    rprojroot_1.3-2 
#&gt; [17] httpcode_0.3.0   pkgdown_1.5.1    crayon_1.3.4     RJSONIO_1.3-1.4 
#&gt; [21] fs_1.4.2         triebeard_0.3.0  ghql_0.1.0       curl_4.3        
#&gt; [25] crul_0.9.0       memoise_1.1.0    evaluate_0.14    rmarkdown_2.3   
#&gt; [29] stringi_1.4.6    compiler_3.6.3   urltools_1.7.3   desc_1.2.0      
#&gt; [33] backports_1.1.8  jsonlite_1.7.0</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paolo Sonego.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
